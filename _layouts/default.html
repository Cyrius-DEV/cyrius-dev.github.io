---
---

<!doctype html>
{% include copyright.html %}
<html lang="{{ site.locale | replace: "_", "-" | default: "en" }}" class="no-js">
  <head>
    {% include head.html %}
    {% include head/custom.html %}
  </head>

  <body class="layout--{{ page.layout | default: layout.layout }}{% if page.classes or layout.classes %}{{ page.classes | default: layout.classes | join: ' ' | prepend: ' ' }}{% endif %}" dir="{% if site.rtl %}rtl{% else %}ltr{% endif %}">
    {% include_cached skip-links.html %}
    {% include_cached masthead.html %}
<main id="swup" class="transition-fade">
  {{ content }}


    <div class="initial-content">
      {% include after-content.html %}
    </div>

    {% if site.search == true %}
      <div class="search-content">
        {% include_cached search/search_form.html %}
      </div>
    {% endif %}
</main>
    <div id="footer" class="page__footer">
      <footer>
        {% include footer/custom.html %}
        {% include_cached footer.html %}
      </footer>
    </div>

<script>
  const messages = [
    { time: 0, text: 'Matin (fixe)' },
    { time: 20, text: 'Transition vers midi' },
    { time: 30, text: 'Midi (fixe)' },
    { time: 50, text: 'Transition vers soir' },
    { time: 60, text: 'Soir (fixe)' },
    { time: 80, text: 'Transition vers nuit' },
    { time: 90, text: 'Nuit (fixe)' },
    { time: 110, text: 'Transition vers matin' }
  ];

  const cycleDuration = 120000; // en millisecondes
  let cycleStart = Date.now();

  function checkCycle() {
    const now = Date.now();
    const elapsed = (now - cycleStart) % cycleDuration;
    const currentSecond = Math.floor(elapsed / 1000);

    for (let i = messages.length - 1; i >= 0; i--) {
      if (currentSecond >= messages[i].time) {
        if (console.lastMessage !== messages[i].text) {
          console.log(messages[i].text);
          console.lastMessage = messages[i].text;
        }
        break;
      }
    }

    requestAnimationFrame(checkCycle);
  }

  console.lastMessage = null;
  requestAnimationFrame(checkCycle);
</script>



<script>
  function waitForMastheadHeight(callback, retries = 20, delay = 50) {
    let lastHeight = 0;

    function check() {
      const masthead = document.querySelector('.masthead');
      if (!masthead) return;

      const currentHeight = masthead.offsetHeight;
      if (currentHeight > 0 && currentHeight !== lastHeight) {
        lastHeight = currentHeight;
        retries--;
        setTimeout(check, delay);
      } else {
        callback(currentHeight);
      }
    }

    check();
  }

  function adjustContentOffset() {
    const initialContent = document.querySelector('.transition-fade');
    const masthead = document.querySelector('.masthead');
    if (masthead && initialContent) {
      const mastheadHeight = masthead.offsetHeight;
      initialContent.style.marginTop = mastheadHeight + 'px';
    }
  }

  // Chargement initial
  window.addEventListener('load', () => {
    waitForMastheadHeight(() => adjustContentOffset());
  });

  window.addEventListener('resize', adjustContentOffset);

  // Sur changement de page avec Swup
  document.addEventListener('swup:contentReplaced', () => {
    waitForMastheadHeight(() => adjustContentOffset());
  });
</script>

    
<script src="https://unpkg.com/swup@4"></script>
<script>
  const swup = new Swup();
</script>

    {% include scripts.html %}
  </body>
</html>
